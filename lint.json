[{"filePath":"/Users/rohanraghani/Downloads/bankey_v2.0/components/Education.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Map' is defined but never used.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GraduationCap' is defined but never used.","line":6,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trophy' is defined but never used.","line":6,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":6,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":89},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":6,"column":91,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HelpCircle' is defined but never used.","line":6,"column":100,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":110},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":6,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":122},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used.","line":6,"column":124,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":129},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Smartphone' is defined but never used.","line":6,"column":179,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":189},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":6,"column":198,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":201},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":6,"column":203,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":209},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shuffle' is defined but never used.","line":6,"column":211,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":218},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/rohanraghani/Downloads/bankey_v2.0/components/Education.tsx:833:13\n  831 |     useEffect(() => {\n  832 |         if (showPlaybook && !playbookModuleId && modules.length > 0) {\n> 833 |             setPlaybookModuleId(modules[0].id);\n      |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  834 |         }\n  835 |     }, [showPlaybook, modules, playbookModuleId]);\n  836 |","line":833,"column":13,"nodeType":null,"endLine":833,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'resetStepState' function makes the dependencies of useEffect Hook (at line 894) change on every render. To fix this, wrap the definition of 'resetStepState' in its own useCallback() Hook.","line":837,"column":11,"nodeType":"VariableDeclarator","endLine":853,"endColumn":6,"suggestions":[{"desc":"Wrap the definition of 'resetStepState' in its own useCallback() Hook.","fix":{"range":[43924,44559],"text":"useCallback(() => {\n        setLessonStatus('idle');\n        setLessonFeedback(null);\n        setPuzzleInput('');\n        setSortCurrentOrder([]);\n        setWrongAttempts(0);\n        setSelectedConnection(null);\n        setMatchedConnections([]);\n        setAllocatorValues([]);\n        setSelectedWords([]);\n\n        // Initialize Allocator if needed\n        const step = activeModule?.steps[currentStepIndex + 1] || activeModule?.steps[0];\n        if (step?.type === 'slider-allocator' && step.allocatorCategories) {\n            setAllocatorValues(step.allocatorCategories.map(c => ({ label: c.label, value: c.startPercent })));\n        }\n    })"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'finishModule' function makes the dependencies of useEffect Hook (at line 894) change on every render. To fix this, wrap the definition of 'finishModule' in its own useCallback() Hook.","line":855,"column":11,"nodeType":"VariableDeclarator","endLine":865,"endColumn":6,"suggestions":[{"desc":"Wrap the definition of 'finishModule' in its own useCallback() Hook.","fix":{"range":[44587,45049],"text":"useCallback(() => {\n        if (!activeModule) return;\n        markUnitComplete(activeModule.id);\n        addXp(activeModule.xpReward);\n        const randomLoot = LOOT_TABLE[Math.floor(Math.random() * LOOT_TABLE.length)];\n        setEarnedLoot(randomLoot);\n        unlockReward(randomLoot.id);\n        setShowVictory(true);\n        setViewMode('map');\n        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#D4FF00', '#FF90E8', '#00FFA3'] });\n    })"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/rohanraghani/Downloads/bankey_v2.0/components/Education.tsx:872:17\n  870 |             const currentStep = activeModule.steps[currentStepIndex];\n  871 |             if (currentStep && currentStep.type === 'connections' && currentStep.connectionPairs) {\n> 872 |                 setShuffledConnectionItems(\n      |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  873 |                     [...currentStep.connectionPairs.map(p => p.term), ...currentStep.connectionPairs.map(p => p.match)]\n  874 |                         .sort(() => Math.random() - 0.5)\n  875 |                 );","line":872,"column":17,"nodeType":null,"endLine":872,"endColumn":43},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/rohanraghani/Downloads/bankey_v2.0/components/Education.tsx:903:17\n  901 |             const step = activeModule.steps[currentStepIndex];\n  902 |             if (step.type === 'slider-allocator' && step.allocatorCategories && allocatorValues.length === 0) {\n> 903 |                 setAllocatorValues(step.allocatorCategories.map(c => ({ label: c.label, value: c.startPercent })));\n      |                 ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  904 |             }\n  905 |         }\n  906 |     }, [activeModule, viewMode, currentStepIndex, allocatorValues.length]);","line":903,"column":17,"nodeType":null,"endLine":903,"endColumn":35}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { useBanky } from '../context/BankyContext';\nimport { EducationModule, LessonOption, RegionCode, LessonStep, AllocatorCategory } from '../types';\nimport { getRealTimeLearnContext } from '../services/geminiService';\nimport { Map as MapIcon, Map, Book, GraduationCap, Trophy, Star, ArrowRight, CheckCircle, XCircle, HelpCircle, Lock, Play, Pause, RotateCcw, Split, Briefcase, Check, Package, X, Smartphone, Globe, Zap, Target, Shuffle, MousePointerClick, ExternalLink, Loader2, ThumbsUp, ThumbsDown, Heart, ArrowLeft, AlertTriangle, BookOpen } from 'lucide-react';\nimport Mascot from './Mascot';\nimport confetti from 'canvas-confetti';\n\n// --- 1. DICTIONARY FOR REGIONAL TERMS ---\nconst LOCALIZATION_MAP: Record<RegionCode, Record<string, string>> = {\n    'US': {\n        'CURRENCY_SYMBOL': '$',\n        'TAX_AGENCY': 'IRS',\n        'RETIREMENT_ACC': '401k',\n        'TAX_FREE_ACC': 'Roth IRA',\n        'CREDIT_SCORE': 'FICO',\n        'INDEX_FUND': 'S&P 500',\n        'ID_NUM': 'SSN',\n        'TAX_SECTION': 'Standard Deduction',\n        'CENTRAL_BANK': 'Federal Reserve',\n        'ESTATE_LAW': 'Probate'\n    },\n    'IN': {\n        'CURRENCY_SYMBOL': '₹',\n        'TAX_AGENCY': 'IT Dept',\n        'RETIREMENT_ACC': 'EPF/NPS',\n        'TAX_FREE_ACC': 'PPF/ELSS',\n        'CREDIT_SCORE': 'CIBIL',\n        'INDEX_FUND': 'Nifty 50',\n        'ID_NUM': 'PAN/Aadhar',\n        'TAX_SECTION': 'Section 80C',\n        'CENTRAL_BANK': 'RBI',\n        'ESTATE_LAW': 'Succession'\n    },\n    'Global': {\n        'CURRENCY_SYMBOL': '$',\n        'TAX_AGENCY': 'Tax Agency',\n        'RETIREMENT_ACC': 'Pension Fund',\n        'TAX_FREE_ACC': 'Tax-Free Account',\n        'CREDIT_SCORE': 'Credit Score',\n        'INDEX_FUND': 'Global Index',\n        'ID_NUM': 'Tax ID',\n        'TAX_SECTION': 'Deductions',\n        'CENTRAL_BANK': 'Central Bank',\n        'ESTATE_LAW': 'Probate'\n    },\n    'UK': {\n        'CURRENCY_SYMBOL': '£', 'TAX_AGENCY': 'HMRC', 'RETIREMENT_ACC': 'Pension', 'TAX_FREE_ACC': 'ISA', 'CREDIT_SCORE': 'Credit Score', 'INDEX_FUND': 'FTSE 100', 'ID_NUM': 'NI Number', 'TAX_SECTION': 'Personal Allowance', 'CENTRAL_BANK': 'Bank of England', 'ESTATE_LAW': 'Probate'\n    },\n    'EU': {\n        'CURRENCY_SYMBOL': '€', 'TAX_AGENCY': 'Tax Authority', 'RETIREMENT_ACC': 'Pension', 'TAX_FREE_ACC': 'Savings Acc', 'CREDIT_SCORE': 'Credit Score', 'INDEX_FUND': 'Stoxx 50', 'ID_NUM': 'Tax ID', 'TAX_SECTION': 'Deductions', 'CENTRAL_BANK': 'ECB', 'ESTATE_LAW': 'Succession'\n    }\n};\n\n// --- 2. CONTENT ADAPTER ENGINE ---\nconst adaptContent = (text: string, region: RegionCode): string => {\n    if (!text) return '';\n    const map = LOCALIZATION_MAP[region] || LOCALIZATION_MAP['Global'];\n    let adapted = text;\n\n    // Replacements\n    adapted = adapted.replace(/401k/g, map['RETIREMENT_ACC']);\n    adapted = adapted.replace(/Roth IRA/g, map['TAX_FREE_ACC']);\n    adapted = adapted.replace(/IRS/g, map['TAX_AGENCY']);\n    adapted = adapted.replace(/FICO/g, map['CREDIT_SCORE']);\n    adapted = adapted.replace(/S&P 500/g, map['INDEX_FUND']);\n    adapted = adapted.replace(/\\$/g, map['CURRENCY_SYMBOL']);\n\n    return adapted;\n};\n\n// --- 3. BASE CURRICULUM ---\nconst BASE_MODULES: EducationModule[] = [\n    // UNIT 1: BASICS\n    {\n        id: 'unit-1',\n        title: 'The Money Mindset',\n        description: 'Stop thinking poor. Start thinking wealthy.',\n        xpReward: 100,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '5m',\n        playbook: {\n            summary: \"Wealth isn't about how much money you make; it's about how much you keep. The fundamental rule: Buy assets, avoid liabilities.\",\n            realLifeExample: \"Alex buys a $50k car (Liability). Sam buys $50k of Index Funds (Asset). In 5 years, the car is worth $20k. The stock is worth $90k.\",\n            definitions: [\n                { term: \"Asset\", definition: \"Puts money IN your pocket.\" },\n                { term: \"Liability\", definition: \"Takes money OUT of your pocket.\" },\n                { term: \"Net Worth\", definition: \"Assets minus Liabilities.\" }\n            ],\n            actionableSteps: [\"List your Assets vs Liabilities.\", \"Cancel one unused subscription today.\"]\n        },\n        steps: [\n            { id: '1-1', type: 'info', content: 'Wealth isn\\'t just cash. It\\'s \"Assets\"—things that put money IN your pocket.' },\n            { id: '1-2', type: 'puzzle', content: 'Decode: A thing that puts money in your pocket.', scramble: 'STSEA', puzzleWord: 'ASSET', hint: 'Opposite of Liability.', correctAnswerExplanation: 'An ASSET is anything that puts money in your pocket (like stocks or real estate). A Liability takes it out.' },\n            { id: '1-3', type: 'fill-blank', content: 'Rich people buy [BLANK], poor people buy liabilities.', fillBlankCorrect: 'Assets', fillBlankOptions: ['Assets', 'Liabilities', 'Stuff'], correctAnswerExplanation: 'Wealthy people prioritize buying income-generating assets first, then use that income to buy luxuries.' },\n            {\n                id: '1-4', type: 'question', content: 'The goal of the game is to...', options: [\n                    { id: 'a', text: 'Buy more liabilities', isCorrect: false, feedback: 'That\\'s the trap! Liabilities drain your wealth.' },\n                    { id: 'b', text: 'Work harder forever', isCorrect: false, feedback: 'Work smarter, not harder. Make money work for you.' },\n                    { id: 'c', text: 'Buy assets that pay for your liabilities', isCorrect: true, feedback: 'Bingo! That is financial freedom.' }\n                ], correctAnswerExplanation: 'Financial Freedom is when your assets generate enough cash flow to pay for your lifestyle.'\n            }\n        ]\n    },\n    {\n        id: 'unit-2',\n        title: 'Budgeting 101',\n        description: 'Tell your money where to go.',\n        xpReward: 150,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '5m',\n        playbook: {\n            summary: \"A budget isn't a restriction; it's a plan. The 50/30/20 rule is the easiest way to start.\",\n            realLifeExample: \"Earn $3000? $1500 for Needs, $900 for Wants, $600 for Savings/Investing.\",\n            definitions: [\n                { term: \"Needs\", definition: \"Rent, Food, Utilities.\" },\n                { term: \"Wants\", definition: \"Netflix, Dining Out, Travel.\" },\n                { term: \"Savings\", definition: \"Investing, Emergency Fund.\" }\n            ],\n            actionableSteps: [\"Review last month's bank statement.\", \"Categorize expenses into Needs/Wants.\"]\n        },\n        steps: [\n            { id: '2-1', type: 'info', content: 'The 50/30/20 Rule: 50% Needs, 30% Wants, 20% Savings.' },\n            { id: '2-2', type: 'sorting', content: 'Sort these into \"Needs\" (Top) vs \"Wants\" (Bottom).', sortCorrectOrder: ['Rent', 'Groceries', 'Netflix', 'Designer Shoes'], correctAnswerExplanation: 'Rent and Food are survival needs. Streaming and Fashion are wants.' },\n            {\n                id: '2-3', type: 'question', content: 'If you earn $1000, how much should go to savings?', options: [\n                    { id: 'a', text: '$100', isCorrect: false, feedback: 'Too low! Aim higher.' },\n                    { id: 'b', text: '$200', isCorrect: true, feedback: 'Correct! 20% of $1000 is $200.' },\n                    { id: 'c', text: '$500', isCorrect: false, feedback: 'Ambitious, but 50% is hard to sustain.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-3',\n        title: 'Compound Interest',\n        description: 'The 8th Wonder of the World.',\n        xpReward: 200,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '3-1', type: 'info', content: 'Compound interest is interest on interest. It makes money grow exponentially.' },\n            { id: '3-2', type: 'fill-blank', content: 'Time in the market beats [BLANK] the market.', fillBlankCorrect: 'Timing', fillBlankOptions: ['Timing', 'Trading', 'Selling'] },\n            { id: '3-3', type: 'puzzle', content: 'Unscramble: The curve of growth.', scramble: 'XPONENTE', puzzleWord: 'EXPONENT', hint: 'Goes up fast.' }\n        ]\n    },\n    {\n        id: 'unit-4',\n        title: 'The Emergency Fund',\n        description: 'Sleep well at night.',\n        xpReward: 150,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '5m',\n        steps: [\n            { id: '4-1', type: 'info', content: 'An emergency fund prevents you from going into debt when bad things happen.' },\n            {\n                id: '4-2', type: 'question', content: 'How much should be in an emergency fund?', options: [\n                    { id: 'a', text: '$500', isCorrect: false, feedback: 'A good start, but not enough.' },\n                    { id: 'b', text: '3-6 months of expenses', isCorrect: true, feedback: 'Yes. This covers job loss or major repairs.' },\n                    { id: 'c', text: '1 year of income', isCorrect: false, feedback: 'A bit overkill for cash sitting idle.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-5',\n        title: 'Bad Debt vs Good Debt',\n        description: 'Not all debt is created equal.',\n        xpReward: 200,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '6m',\n        steps: [\n            { id: '5-1', type: 'sorting', content: 'Order from \"Worst Debt\" to \"Best Debt\".', sortCorrectOrder: ['Payday Loan', 'Credit Card (20%)', 'Student Loan (5%)', 'Mortgage (3%)'] },\n            {\n                id: '5-2', type: 'question', content: 'Why is a mortgage considered \"Good Debt\"?', options: [\n                    { id: 'a', text: 'It isn\\'t.', isCorrect: false, feedback: 'Real estate generally appreciates.' },\n                    { id: 'b', text: 'It buys an appreciating asset.', isCorrect: true, feedback: 'Correct. The house value usually goes up over time.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-6',\n        title: 'Stocks & Equities',\n        description: 'Owning a piece of a company.',\n        xpReward: 250,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '7m',\n        steps: [\n            { id: '6-1', type: 'info', content: 'When you buy a stock, you become a partial owner of that business.' },\n            { id: '6-2', type: 'fill-blank', content: 'A [BLANK] is a payment of profit to shareholders.', fillBlankCorrect: 'Dividend', fillBlankOptions: ['Dividend', 'Coupon', 'Interest'] },\n            { id: '6-3', type: 'puzzle', content: 'Unscramble: A collection of stocks.', scramble: 'TF E', puzzleWord: 'ETF', hint: 'Exchange Traded Fund.' }\n        ]\n    },\n    {\n        id: 'unit-7',\n        title: 'ETFs & Index Funds',\n        description: 'Don\\'t find the needle, buy the haystack.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '7-1', type: 'info', content: 'Index funds track the whole market (like S&P 500). They are lower risk than picking single stocks.' },\n            {\n                id: '7-2', type: 'question', content: 'What is the main benefit of an ETF?', options: [\n                    { id: 'a', text: 'Guaranteed 100% returns', isCorrect: false, feedback: 'Nothing is guaranteed.' },\n                    { id: 'b', text: 'Diversification', isCorrect: true, feedback: 'Yes! You own hundreds of companies at once.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-8',\n        title: 'The Credit Score',\n        description: 'Your financial report card.',\n        xpReward: 200,\n        isCompleted: false,\n        category: 'Credit',\n        estimatedTime: '6m',\n        steps: [\n            { id: '8-1', type: 'info', content: 'Your FICO score determines if you can get a loan and what interest rate you pay.' },\n            { id: '8-2', type: 'fill-blank', content: 'Keep your credit utilization below [BLANK]%.', fillBlankCorrect: '30', fillBlankOptions: ['30', '50', '80'] },\n            {\n                id: '8-3', type: 'question', content: 'What hurts your score the most?', options: [\n                    { id: 'a', text: 'Checking your own score', isCorrect: false, feedback: 'Soft pulls don\\'t hurt.' },\n                    { id: 'b', text: 'Missing a payment', isCorrect: true, feedback: 'Yes. Payment history is 35% of your score.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-9',\n        title: 'Credit Cards: A Weapon',\n        description: 'Use them, don\\'t let them use you.',\n        xpReward: 200,\n        isCompleted: false,\n        category: 'Credit',\n        estimatedTime: '5m',\n        steps: [\n            { id: '9-1', type: 'info', content: 'Credit cards offer rewards and fraud protection, but high interest if unpaid.' },\n            {\n                id: '9-2', type: 'question', content: 'How do you avoid interest?', options: [\n                    { id: 'a', text: 'Pay the minimum', isCorrect: false, feedback: 'You will still be charged interest on the rest.' },\n                    { id: 'b', text: 'Pay the full balance', isCorrect: true, feedback: 'Correct. Pay in full every month = $0 interest.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-10',\n        title: 'Taxes 101',\n        description: 'Uncle Sam wants his cut.',\n        xpReward: 250,\n        isCompleted: false,\n        category: 'Taxes',\n        estimatedTime: '7m',\n        steps: [\n            { id: '10-1', type: 'info', content: 'Gross income is what you earn. Net income is what you keep after taxes.' },\n            { id: '10-2', type: 'puzzle', content: 'Unscramble: Money back from the gov.', scramble: 'DNEFUR', puzzleWord: 'REFUND', hint: 'Tax season bonus.' },\n            { id: '10-3', type: 'fill-blank', content: 'A tax [BLANK] reduces your taxable income.', fillBlankCorrect: 'Deduction', fillBlankOptions: ['Deduction', 'Evasion', 'Bill'] }\n        ]\n    },\n    {\n        id: 'unit-11',\n        title: 'Retirement Accounts',\n        description: 'Free money from the government.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '11-1', type: 'connections', content: 'Match the account to its benefit.', connectionPairs: [{ term: '401k', match: 'Employer Match' }, { term: 'Roth IRA', match: 'Tax-Free Growth' }, { term: 'Traditional IRA', match: 'Tax Deduction Now' }] },\n            {\n                id: '11-2', type: 'question', content: 'If your employer offers a match, you should...', options: [\n                    { id: 'a', text: 'Ignore it', isCorrect: false, feedback: 'Never turn down free money.' },\n                    { id: 'b', text: 'Contribute enough to get it', isCorrect: true, feedback: 'Always take the match. It is an instant 100% return.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-12',\n        title: 'Inflation',\n        description: 'The silent killer of cash.',\n        xpReward: 150,\n        isCompleted: false,\n        category: 'Economics',\n        estimatedTime: '5m',\n        steps: [\n            { id: '12-1', type: 'info', content: 'Inflation means things get more expensive over time. Cash loses value.' },\n            {\n                id: '12-2', type: 'question', content: 'If inflation is 3% and your bank pays 0.1%...', options: [\n                    { id: 'a', text: 'You are losing purchasing power', isCorrect: true, feedback: 'Correct. You effectively lost 2.9% of value.' },\n                    { id: 'b', text: 'You are making money', isCorrect: false, feedback: 'Not in real terms.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-13',\n        title: 'Real Estate',\n        description: 'Land: They aren\\'t making any more of it.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Assets',\n        estimatedTime: '7m',\n        steps: [\n            { id: '13-1', type: 'fill-blank', content: 'Rental income is a form of [BLANK] cash flow.', fillBlankCorrect: 'Passive', fillBlankOptions: ['Passive', 'Active', 'Negative'] },\n            { id: '13-2', type: 'puzzle', content: 'Unscramble: The loan for a house.', scramble: 'EGAGTROM', puzzleWord: 'MORTGAGE', hint: 'Monthly house payment.' }\n        ]\n    },\n    {\n        id: 'unit-14',\n        title: 'Crypto & High Risk',\n        description: 'High risk, high reward (maybe).',\n        xpReward: 250,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '14-1', type: 'info', content: 'Crypto is volatile. Never invest money you cannot afford to lose.' },\n            { id: '14-2', type: 'sorting', content: 'Sort by Risk (Low to High).', sortCorrectOrder: ['Savings Account', 'Index Fund', 'Individual Stock', 'Crypto/NFT'] }\n        ]\n    },\n    {\n        id: 'unit-15',\n        title: 'Side Hustles',\n        description: 'Multiple streams of income.',\n        xpReward: 200,\n        isCompleted: false,\n        category: 'Business',\n        estimatedTime: '5m',\n        steps: [\n            {\n                id: '15-1', type: 'question', content: 'The best side hustle is...', options: [\n                    { id: 'a', text: 'Driving Uber', isCorrect: false, feedback: 'It pays, but it is not scalable.' },\n                    { id: 'b', text: 'One that scales or teaches skills', isCorrect: true, feedback: 'Correct. Build assets or skills, not just hourly wages.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-16',\n        title: 'Negotiation Power',\n        description: 'Ask and you shall receive.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Business',\n        estimatedTime: '6m',\n        steps: [\n            { id: '16-1', type: 'info', content: 'Your salary is negotiable. Never accept the first offer immediately.' },\n            { id: '16-2', type: 'fill-blank', content: 'Always do your [BLANK] on market rates before negotiating.', fillBlankCorrect: 'Research', fillBlankOptions: ['Research', 'Guessing', 'Complaining'] }\n        ]\n    },\n    {\n        id: 'unit-17',\n        title: 'Financial Independence (FIRE)',\n        description: 'Retire early, live freely.',\n        xpReward: 500,\n        isCompleted: false,\n        category: 'Advanced',\n        estimatedTime: '8m',\n        steps: [\n            { id: '17-1', type: 'info', content: 'The 4% Rule: If you can live on 4% of your portfolio, you are financially free.' },\n            {\n                id: '17-2', type: 'question', content: 'If you spend $40k a year, how much do you need to retire?', options: [\n                    { id: 'a', text: '$400k', isCorrect: false, feedback: 'Too low.' },\n                    { id: 'b', text: '$1 Million', isCorrect: true, feedback: 'Correct. $1M * 4% = $40,000.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-18',\n        title: 'Bull vs Bear',\n        description: 'Decode the market animal kingdom.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '5m',\n        steps: [\n            { id: '18-1', type: 'info', content: 'Markets move in cycles. \"Bull\" means up (horns thrust up). \"Bear\" means down (claws swipe down).' },\n            { id: '18-2', type: 'connections', content: 'Connect the term to the definition.', connectionPairs: [{ term: 'Bull Market', match: 'Prices Rising' }, { term: 'Bear Market', match: 'Prices Falling' }, { term: 'Correction', match: 'Drop of 10%' }] },\n            {\n                id: '18-3', type: 'question', content: 'What is the best strategy in a Bear Market?', options: [\n                    { id: 'a', text: 'Panic Sell', isCorrect: false, feedback: 'Never panic sell. You lock in losses.' },\n                    { id: 'b', text: 'Buy the dip', isCorrect: true, feedback: 'Correct. Stocks are on sale.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-19',\n        title: 'Scam Dojo',\n        description: 'Defend your digital wallet.',\n        xpReward: 350,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '6m',\n        steps: [\n            { id: '19-1', type: 'sorting', content: 'Sort into Safe vs Scam.', sortCorrectOrder: ['Bank App', 'Official Email', 'IG DM \"Free Crypto\"', 'WhatsApp \"IRS Agent\"'] },\n            {\n                id: '19-2', type: 'question', content: 'Your bank calls asking for your password. You...', options: [\n                    { id: 'a', text: 'Give it to them', isCorrect: false, feedback: 'Banks NEVER ask for passwords.' },\n                    { id: 'b', text: 'Hang up and call the official number', isCorrect: true, feedback: 'Always verify the source.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-20',\n        title: 'Networking 2.0',\n        description: 'Your network is your net worth.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Business',\n        estimatedTime: '5m',\n        steps: [\n            { id: '20-1', type: 'fill-blank', content: 'People do business with people they [BLANK].', fillBlankCorrect: 'Trust', fillBlankOptions: ['Trust', 'Fear', 'Pay'] },\n            {\n                id: '20-2', type: 'question', content: 'The best way to network is...', options: [\n                    { id: 'a', text: 'Asking for favors immediately', isCorrect: false, feedback: 'No. Give value first.' },\n                    { id: 'b', text: 'Providing value to others', isCorrect: true, feedback: 'Correct. Help others get what they want.' }\n                ]\n            }\n        ]\n    },\n    {\n        id: 'unit-21',\n        title: 'Auto-Pilot Wealth',\n        description: 'Set it and forget it.',\n        xpReward: 400,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '4m',\n        steps: [\n            { id: '21-1', type: 'info', content: 'Willpower fails. Automation doesn\\'t. Automate your savings and bills.' },\n            { id: '21-2', type: 'puzzle', content: 'Unscramble: Automatic payments.', scramble: 'TOUA YAP', puzzleWord: 'AUTOPAY', hint: 'Never miss a bill.' }\n        ]\n    },\n    {\n        id: 'unit-22',\n        title: 'The Final Boss',\n        description: 'Test everything you have learned.',\n        xpReward: 1000,\n        isCompleted: false,\n        category: 'Advanced',\n        estimatedTime: '10m',\n        steps: [\n            { id: '22-1', type: 'question', content: 'Which asset class historically has the highest return?', options: [{ id: 'a', text: 'Cash', isCorrect: false, feedback: 'Loses to inflation.' }, { id: 'b', text: 'Stocks', isCorrect: true, feedback: 'Avg 10% per year.' }] },\n            { id: '22-2', type: 'sorting', content: 'Order the steps to wealth.', sortCorrectOrder: ['Earn Income', 'Save Emergency Fund', 'Pay High Interest Debt', 'Invest in Index Funds'] },\n            { id: '22-3', type: 'connections', content: 'Match the concepts.', connectionPairs: [{ term: 'Inflation', match: 'Prices Up' }, { term: 'Deflation', match: 'Prices Down' }, { term: 'Stagflation', match: 'Stagnant + Inflation' }] },\n            { id: '22-4', type: 'puzzle', content: 'Decode the goal.', scramble: 'MODEERF', puzzleWord: 'FREEDOM', hint: 'What money buys.' }\n        ]\n    },\n    {\n        id: 'unit-23',\n        title: 'Brain vs Marketing',\n        description: 'Don\\'t get played by the pros.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '6m',\n        playbook: {\n            summary: \"Marketers use psychology to make you spend. Common tricks: Scarcity ('Only 2 left!'), Anchoring (Fake high price crossed out), and Decoys.\",\n            realLifeExample: \"Popcorn: Small $3, Medium $6.50, Large $7. The Medium exists only to make the Large look like a deal.\",\n            definitions: [\n                { term: \"Anchoring\", definition: \"Relying on the first piece of info (price) offered.\" },\n                { term: \"Loss Aversion\", definition: \"Fear of missing out > Joy of gaining.\" }\n            ],\n            actionableSteps: [\"Wait 24 hours before buying non-essentials.\", \"Ignore 'original' prices, look at final cost.\"]\n        },\n        steps: [\n            { id: '23-1', type: 'info', content: 'The \"Decoy Effect\" makes you buy the expensive option by adding a bad middle option.' },\n            {\n                id: '23-2', type: 'scenario', content: 'You see 3 subscriptions. Which one is the Decoy?', scenarioOptions: [\n                    { text: 'Digital Only: $50', isCorrect: false, feedback: 'This is the basic option.' },\n                    { text: 'Print Only: $120', isCorrect: true, feedback: 'Correct! It costs the same as Print + Digital but offers less. It exists to push you to the Bundle.' },\n                    { text: 'Print + Digital: $120', isCorrect: false, feedback: 'This is the target \"Deal\".' }\n                ]\n            },\n            { id: '23-3', type: 'puzzle', content: 'Decode: Fear of Missing Out.', scramble: 'OMFO', puzzleWord: 'FOMO', hint: 'Social pressure to buy.' }\n        ]\n    },\n    {\n        id: 'unit-24',\n        title: 'Shield Up (Insurance)',\n        description: 'Protect your loot.',\n        xpReward: 300,\n        isCompleted: false,\n        category: 'Assets',\n        estimatedTime: '7m',\n        playbook: {\n            summary: \"Insurance transfers risk from you to a company. You pay a 'Premium' to avoid a catastrophic 'Loss'.\",\n            realLifeExample: \"You pay $100/mo for car insurance. You crash ($10k damage). You pay $500 deductible, they pay $9,500.\",\n            definitions: [\n                { term: \"Premium\", definition: \"Monthly cost of insurance.\" },\n                { term: \"Deductible\", definition: \"What you pay before insurance kicks in.\" }\n            ],\n            actionableSteps: [\"Check if you have renters/homeowners insurance.\", \"Shop rates yearly.\"]\n        },\n        steps: [\n            { id: '24-1', type: 'info', content: 'High Deductible = Low Premium. Low Deductible = High Premium.' },\n            { id: '24-2', type: 'connections', content: 'Match the Insurance to the Risk.', connectionPairs: [{ term: 'Health', match: 'Hospital Bills' }, { term: 'Auto', match: 'Car Crash' }, { term: 'Life', match: 'Death of earner' }] },\n            { id: '24-3', type: 'sorting', content: 'Order steps of a claim.', sortCorrectOrder: ['Accident Happens', 'File Claim', 'Pay Deductible', 'Insurer Pays Rest'] }\n        ]\n    },\n    {\n        id: 'unit-25',\n        title: 'The Founder',\n        description: 'Basics of starting a business.',\n        xpReward: 500,\n        isCompleted: false,\n        category: 'Business',\n        estimatedTime: '8m',\n        playbook: {\n            summary: \"Business is solving problems for profit. Revenue - Expenses = Profit.\",\n            realLifeExample: \"Lemonade Stand. Lemons/Sugar ($20) + Cup Cost ($5) = Expenses. Sales ($100) = Revenue. Profit = $75.\",\n            definitions: [\n                { term: \"Revenue\", definition: \"Total money coming in.\" },\n                { term: \"Profit\", definition: \"Money left after bills.\" },\n                { term: \"Margin\", definition: \"Percentage of profit per sale.\" }\n            ],\n            actionableSteps: [\"Identify a problem people pay to solve.\", \"Start small (MVP).\"]\n        },\n        steps: [\n            { id: '25-1', type: 'info', content: 'Revenue is vanity. Profit is sanity. Cash flow is reality.' },\n            {\n                id: '25-2', type: 'question', content: 'What is \"Bootstrapping\"?', options: [\n                    { id: 'a', text: 'Wearing boots', isCorrect: false, feedback: 'Fashionable, but no.' },\n                    { id: 'b', text: 'Funding it yourself', isCorrect: true, feedback: 'Correct. Growing without outside investors.' },\n                    { id: 'c', text: 'Getting a loan', isCorrect: false, feedback: 'That is debt financing.' }\n                ]\n            },\n            { id: '25-3', type: 'connections', content: 'Match the role.', connectionPairs: [{ term: 'CEO', match: 'Vision' }, { term: 'CFO', match: 'Money' }, { term: 'CTO', match: 'Tech' }] }\n        ]\n    },\n    {\n        id: 'unit-26',\n        title: 'Budget Architect',\n        description: 'Design the perfect budget.',\n        xpReward: 1200,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '8m',\n        playbook: {\n            summary: \"Budgeting is balancing. Use the 50/30/20 rule to keep your life stable while building wealth.\",\n            realLifeExample: \"On a $4000 income: $2000 for needs, $1200 for fun, $800 for future you.\",\n            definitions: [\n                { term: \"Allocation\", definition: \"Assigning money to specific jobs.\" },\n                { term: \"Zero-Based\", definition: \"Every dollar has a purpose.\" }\n            ],\n            actionableSteps: [\"Check your last month's spending ratios.\"]\n        },\n        steps: [\n            { id: '26-1', type: 'info', content: 'Let\\'s practice the 50/30/20 Rule. You are the architect of your paycheck.' },\n            {\n                id: '26-2',\n                type: 'slider-allocator',\n                content: 'Allocate your paycheck to hit the 50/30/20 balance.',\n                allocatorCategories: [\n                    { label: 'Needs (Rent/Food)', targetPercent: 50, startPercent: 20 },\n                    { label: 'Wants (Fun/Travel)', targetPercent: 30, startPercent: 60 },\n                    { label: 'Savings (Investing)', targetPercent: 20, startPercent: 20 }\n                ],\n                correctAnswerExplanation: 'Perfect balance! 50% for Needs covers survival. 30% for Wants keeps you happy. 20% for Savings builds your freedom.'\n            },\n            {\n                id: '26-3',\n                type: 'slider-allocator',\n                content: 'Aggressive Saving Mode (FIRE): Adjust for a 50% Savings Rate!',\n                allocatorCategories: [\n                    { label: 'Needs', targetPercent: 40, startPercent: 50 },\n                    { label: 'Wants', targetPercent: 10, startPercent: 40 },\n                    { label: 'Savings', targetPercent: 50, startPercent: 10 }\n                ],\n                correctAnswerExplanation: 'Hardcore! To save 50%, you usually have to cut Wants drastically and keep Needs low. This is how you retire in 10 years.'\n            }\n        ]\n    },\n    {\n        id: 'unit-27',\n        title: 'Red Flag Hunter',\n        description: 'Spot the scam before you click.',\n        xpReward: 1200,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '8m',\n        playbook: {\n            summary: \"Scammers use urgency and fear. Learn to spot the keywords they hide in plain sight.\",\n            realLifeExample: \"Emails claiming 'Account Suspended' are usually fake. Check the sender address.\",\n            definitions: [\n                { term: \"Phishing\", definition: \"Fake messages luring you to click.\" },\n                { term: \"Spoofing\", definition: \"Faking a phone number or email.\" }\n            ],\n            actionableSteps: [\"Hover over links before clicking.\", \"Never send crypto to 'verify' a wallet.\"]\n        },\n        steps: [\n            { id: '27-1', type: 'info', content: 'Scammers are smart, but they use the same words over and over. Learn to hunt the Red Flags.' },\n            {\n                id: '27-2',\n                type: 'text-selector',\n                content: 'Tap the 3 suspicious words in this text message.',\n                hint: 'Look for urgency and requests for info.',\n                selectorTargetPhrases: ['URGENT', 'suspended', 'password'],\n                correctAnswerExplanation: 'Banks never text you \"URGENT\", they don\\'t say your account is \"suspended\" via SMS, and they NEVER ask for your \"password\".'\n            },\n            {\n                id: '27-3',\n                type: 'text-selector',\n                content: 'Analyze this \"Job Offer\" email. Find the 3 lies.',\n                hint: 'Too good to be true?',\n                selectorTargetPhrases: ['daily', 'No Experience', 'check'],\n                correctAnswerExplanation: 'Making $500 \"daily\" with \"No Experience\" is a lie. Sending you a \"check\" to buy equipment is a classic fake check scam.'\n            }\n        ]\n    },\n    // NEW UNIT 28: ASSET VS LIABILITY (BINARY CHOICE)\n    {\n        id: 'unit-28',\n        title: 'Rapid Fire: Assets',\n        description: 'Think fast. Wealthy or Broke?',\n        xpReward: 1500,\n        isCompleted: false,\n        category: 'Basics',\n        estimatedTime: '3m',\n        steps: [\n            { id: '28-1', type: 'info', content: 'Welcome to the Speed Round. You have to decide instantly: Asset (Puts money in pocket) or Liability (Takes money out).' },\n            {\n                id: '28-2', type: 'binary-choice', content: 'A Brand New Luxury Car',\n                binaryLeft: { label: 'Asset', isCorrect: false, feedback: 'Nope. Cars depreciate instantly.' },\n                binaryRight: { label: 'Liability', isCorrect: true, feedback: 'Correct! Gas, insurance, and value drop.' }\n            },\n            {\n                id: '28-3', type: 'binary-choice', content: 'Rental Property',\n                binaryLeft: { label: 'Asset', isCorrect: true, feedback: 'Yes! Tenants pay you rent.' },\n                binaryRight: { label: 'Liability', isCorrect: false, feedback: 'Only if it is empty. Usually, it is an asset.' }\n            },\n            {\n                id: '28-4', type: 'binary-choice', content: 'A Designer Watch',\n                binaryLeft: { label: 'Asset', isCorrect: false, feedback: 'Rarely. Most watches lose value.' },\n                binaryRight: { label: 'Liability', isCorrect: true, feedback: 'Correct. It does not pay you to own it.' }\n            },\n            {\n                id: '28-5', type: 'binary-choice', content: 'Dividend Stocks',\n                binaryLeft: { label: 'Asset', isCorrect: true, feedback: 'Bingo. You get paid quarterly just for owning them.' },\n                binaryRight: { label: 'Liability', isCorrect: false, feedback: 'Incorrect. This is a classic asset.' }\n            }\n        ]\n    },\n    // NEW UNIT 29: THE FINE PRINT (TEXT SELECTOR)\n    {\n        id: 'unit-29',\n        title: 'The Fine Print',\n        description: 'Find the traps in the contract.',\n        xpReward: 1500,\n        isCompleted: false,\n        category: 'Credit',\n        estimatedTime: '7m',\n        steps: [\n            { id: '29-1', type: 'info', content: 'Predatory lenders hide their traps in the fine print. Let\\'s analyze a \"Payday Loan\" contract.' },\n            {\n                id: '29-2',\n                type: 'text-selector',\n                content: 'Tap the 3 dangerous terms in this loan agreement.',\n                hint: 'Look for high costs and access to your data.',\n                selectorTargetPhrases: ['400%', 'wage garnishment', 'contacts'],\n                correctAnswerExplanation: 'A \"400%\" APR is a debt trap. \"Wage garnishment\" means they take money from your paycheck. Accessing your \"contacts\" means they will harass your friends.'\n            }\n        ]\n    },\n    // NEW UNIT 30: AGE & RISK (SLIDER ALLOCATOR)\n    {\n        id: 'unit-30',\n        title: 'Risk Profiler',\n        description: 'How to invest at 25 vs 65.',\n        xpReward: 1500,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '30-1', type: 'info', content: 'Your investment strategy should change as you age. Young = Growth (Risk). Old = Preservation (Safe).' },\n            {\n                id: '30-2',\n                type: 'slider-allocator',\n                content: 'You are 25 years old. Build a portfolio for MAXIMUM GROWTH.',\n                allocatorCategories: [\n                    { label: 'Stocks (Risky/High Reward)', targetPercent: 90, startPercent: 50 },\n                    { label: 'Bonds (Safe/Low Reward)', targetPercent: 10, startPercent: 50 }\n                ],\n                correctAnswerExplanation: 'At 25, you have decades to recover from crashes, so you should own mostly stocks for growth.'\n            },\n            {\n                id: '30-3',\n                type: 'slider-allocator',\n                content: 'You are 65 and retired. Build a portfolio for INCOME & SAFETY.',\n                allocatorCategories: [\n                    { label: 'Stocks', targetPercent: 40, startPercent: 90 },\n                    { label: 'Bonds/Cash', targetPercent: 60, startPercent: 10 }\n                ],\n                correctAnswerExplanation: 'In retirement, you cannot afford a 50% market crash. You need bonds and cash to pay your bills.'\n            }\n        ]\n    },\n    // NEW UNIT 31: EMOTIONAL TRADER\n    {\n        id: 'unit-31',\n        title: 'Emotional Trader',\n        description: 'Master your mind, master the market.',\n        xpReward: 1500,\n        isCompleted: false,\n        category: 'Investing',\n        estimatedTime: '6m',\n        steps: [\n            { id: '31-1', type: 'info', content: 'The stock market is a device for transferring money from the impatient to the patient.' },\n            { id: '31-2', type: 'connections', content: 'Match the Emotion to the Action.', connectionPairs: [{ term: 'FOMO', match: 'Buying at the Top' }, { term: 'Panic', match: 'Selling at the Bottom' }, { term: 'Discipline', match: 'Holding during crash' }] },\n            {\n                id: '31-3',\n                type: 'binary-choice',\n                content: 'Market crashes 20% tomorrow. What do you do?',\n                binaryLeft: { label: 'Sell Everything', isCorrect: false, feedback: 'You just locked in your losses. Bad move.' },\n                binaryRight: { label: 'Do Nothing / Buy', isCorrect: true, feedback: 'Correct. Stocks are on sale.' }\n            }\n        ]\n    }\n];\n\n// --- 4. HELPER TO GENERATE LOCALIZED MODULES ---\nconst getLocalizedModules = (region: RegionCode): EducationModule[] => {\n    return BASE_MODULES.map(mod => ({\n        ...mod,\n        title: adaptContent(mod.title, region),\n        description: adaptContent(mod.description, region),\n        playbook: mod.playbook ? {\n            summary: adaptContent(mod.playbook.summary, region),\n            realLifeExample: adaptContent(mod.playbook.realLifeExample, region),\n            definitions: mod.playbook.definitions.map(d => ({\n                term: adaptContent(d.term, region),\n                definition: adaptContent(d.definition, region)\n            })),\n            actionableSteps: mod.playbook.actionableSteps.map(s => adaptContent(s, region))\n        } : undefined,\n        steps: mod.steps.map(step => ({\n            ...step,\n            content: adaptContent(step.content, region),\n            correctAnswerExplanation: adaptContent(step.correctAnswerExplanation || '', region),\n            options: step.options?.map(o => ({ ...o, text: adaptContent(o.text, region), feedback: adaptContent(o.feedback, region) })),\n            scenarioOptions: step.scenarioOptions?.map(o => ({ ...o, text: adaptContent(o.text, region), feedback: adaptContent(o.feedback, region) })),\n            connectionPairs: step.connectionPairs?.map(p => ({ term: adaptContent(p.term, region), match: adaptContent(p.match, region) })),\n            fillBlankCorrect: step.fillBlankCorrect ? adaptContent(step.fillBlankCorrect, region) : undefined,\n            fillBlankOptions: step.fillBlankOptions?.map(o => adaptContent(o, region)),\n            sortCorrectOrder: step.sortCorrectOrder?.map(o => adaptContent(o, region)),\n            allocatorCategories: step.allocatorCategories?.map(c => ({ ...c, label: adaptContent(c.label, region) })),\n            selectorTargetPhrases: step.selectorTargetPhrases?.map(p => adaptContent(p, region)),\n            // Adapt Binary Choice\n            binaryLeft: step.binaryLeft ? { ...step.binaryLeft, label: adaptContent(step.binaryLeft.label, region), feedback: adaptContent(step.binaryLeft.feedback, region) } : undefined,\n            binaryRight: step.binaryRight ? { ...step.binaryRight, label: adaptContent(step.binaryRight.label, region), feedback: adaptContent(step.binaryRight.feedback, region) } : undefined,\n        }))\n    }));\n};\n\nconst LOOT_TABLE = [\n    { id: 'coin_bronze', name: 'Bronze Coin', emoji: '🥉', rarity: 'Common' },\n    { id: 'coin_silver', name: 'Silver Coin', emoji: '🥈', rarity: 'Common' },\n    { id: 'piggy', name: 'Savings Pig', emoji: '🐷', rarity: 'Common' },\n    { id: 'chart', name: 'Stonk Up', emoji: '📈', rarity: 'Uncommon' },\n    { id: 'bull', name: 'Bull Market', emoji: '🐂', rarity: 'Uncommon' },\n    { id: 'diamond', name: 'Diamond Hands', emoji: '💎', rarity: 'Rare' },\n    { id: 'bag', name: 'Secure The Bag', emoji: '💰', rarity: 'Rare' },\n    { id: 'rocket', name: 'Moon Shot', emoji: '🚀', rarity: 'Legendary' },\n];\n\nconst Education: React.FC = () => {\n    const { userState, addXp, unlockReward, markUnitComplete, region, setRegion } = useBanky();\n\n    // Generate Localized Content on render\n    const modules = React.useMemo(() => getLocalizedModules(region), [region]);\n\n    // View State\n    const [viewMode, setViewMode] = useState<'map' | 'lesson'>('map');\n    const [showInventory, setShowInventory] = useState(false);\n    const [showPlaybook, setShowPlaybook] = useState(false);\n    const [showRegionMenu, setShowRegionMenu] = useState(false);\n    const [pendingRegion, setPendingRegion] = useState<RegionCode | null>(null);\n\n    // Live Context State\n    const [showLiveContext, setShowLiveContext] = useState<string | null>(null);\n    const [liveContextData, setLiveContextData] = useState<{ text: string, sources: { title: string, uri: string }[] } | null>(null);\n    const [isFetchingContext, setIsFetchingContext] = useState(false);\n\n    // Playbook UI State\n    const [playbookModuleId, setPlaybookModuleId] = useState<string | null>(null);\n    const [playbookTab, setPlaybookTab] = useState<'summary' | 'real-life' | 'dictionary' | 'actions'>('summary');\n\n    const [activeModule, setActiveModule] = useState<EducationModule | null>(null);\n\n    // Lesson State\n    const [currentStepIndex, setCurrentStepIndex] = useState(0);\n    const [hearts, setHearts] = useState(3);\n    const [combo, setCombo] = useState(0);\n    const [lessonFeedback, setLessonFeedback] = useState<{ isCorrect: boolean; text: string } | null>(null);\n    const [lessonStatus, setLessonStatus] = useState<'idle' | 'correct' | 'wrong' | 'mercy'>('idle');\n\n    // Game Specific States\n    const [puzzleInput, setPuzzleInput] = useState('');\n    const [puzzleShake, setPuzzleShake] = useState(false);\n    const [wrongAttempts, setWrongAttempts] = useState(0);\n\n    const [sortCurrentOrder, setSortCurrentOrder] = useState<string[]>([]);\n    const [selectedConnection, setSelectedConnection] = useState<string | null>(null);\n    const [matchedConnections, setMatchedConnections] = useState<string[]>([]);\n\n    // -- NEW STATES FOR GAMES --\n    const [allocatorValues, setAllocatorValues] = useState<{ label: string, value: number }[]>([]);\n    const [selectedWords, setSelectedWords] = useState<string[]>([]);\n    const [shuffledConnectionItems, setShuffledConnectionItems] = useState<string[]>([]);\n\n    // Victory State\n    const [showVictory, setShowVictory] = useState(false);\n    const [earnedLoot, setEarnedLoot] = useState<typeof LOOT_TABLE[0] | null>(null);\n\n    // Auto-select first playbook module\n    useEffect(() => {\n        if (showPlaybook && !playbookModuleId && modules.length > 0) {\n            setPlaybookModuleId(modules[0].id);\n        }\n    }, [showPlaybook, modules, playbookModuleId]);\n\n    const resetStepState = () => {\n        setLessonStatus('idle');\n        setLessonFeedback(null);\n        setPuzzleInput('');\n        setSortCurrentOrder([]);\n        setWrongAttempts(0);\n        setSelectedConnection(null);\n        setMatchedConnections([]);\n        setAllocatorValues([]);\n        setSelectedWords([]);\n\n        // Initialize Allocator if needed\n        const step = activeModule?.steps[currentStepIndex + 1] || activeModule?.steps[0];\n        if (step?.type === 'slider-allocator' && step.allocatorCategories) {\n            setAllocatorValues(step.allocatorCategories.map(c => ({ label: c.label, value: c.startPercent })));\n        }\n    };\n\n    const finishModule = () => {\n        if (!activeModule) return;\n        markUnitComplete(activeModule.id);\n        addXp(activeModule.xpReward);\n        const randomLoot = LOOT_TABLE[Math.floor(Math.random() * LOOT_TABLE.length)];\n        setEarnedLoot(randomLoot);\n        unlockReward(randomLoot.id);\n        setShowVictory(true);\n        setViewMode('map');\n        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#D4FF00', '#FF90E8', '#00FFA3'] });\n    };\n\n    // --- Effect: Shuffle Connections ---\n    useEffect(() => {\n        if (activeModule && viewMode === 'lesson') {\n            const currentStep = activeModule.steps[currentStepIndex];\n            if (currentStep && currentStep.type === 'connections' && currentStep.connectionPairs) {\n                setShuffledConnectionItems(\n                    [...currentStep.connectionPairs.map(p => p.term), ...currentStep.connectionPairs.map(p => p.match)]\n                        .sort(() => Math.random() - 0.5)\n                );\n            }\n        }\n    }, [activeModule, viewMode, currentStepIndex]);\n\n    // --- Effect: Handle Auto-Advance ---\n    useEffect(() => {\n        let timer: ReturnType<typeof setTimeout>;\n        if (lessonStatus === 'correct' && activeModule) {\n            timer = setTimeout(() => {\n                if (currentStepIndex < activeModule.steps.length - 1) {\n                    setCurrentStepIndex(prev => prev + 1);\n                    resetStepState();\n                } else {\n                    finishModule();\n                }\n            }, 2500);\n        }\n        return () => clearTimeout(timer);\n    }, [lessonStatus, currentStepIndex, activeModule, finishModule, resetStepState]);\n\n\n\n    // Initialize Allocator for first step if needed\n    useEffect(() => {\n        if (activeModule && viewMode === 'lesson') {\n            const step = activeModule.steps[currentStepIndex];\n            if (step.type === 'slider-allocator' && step.allocatorCategories && allocatorValues.length === 0) {\n                setAllocatorValues(step.allocatorCategories.map(c => ({ label: c.label, value: c.startPercent })));\n            }\n        }\n    }, [activeModule, viewMode, currentStepIndex, allocatorValues.length]);\n\n\n    // --- Handlers ---\n\n    const handleRegionChange = (newRegion: RegionCode) => {\n        setPendingRegion(newRegion);\n    };\n\n    const confirmRegionChange = () => {\n        if (pendingRegion) {\n            setRegion(pendingRegion);\n            setPendingRegion(null);\n            setShowRegionMenu(false);\n            setPlaybookModuleId(null);\n        }\n    };\n\n    const handleStartModule = (module: EducationModule) => {\n        setActiveModule(module);\n        setViewMode('lesson');\n        setCurrentStepIndex(0);\n        setHearts(3);\n        setCombo(0);\n        resetStepState();\n    };\n\n    const handleLiveContext = async (moduleId: string, topic: string) => {\n        setShowLiveContext(moduleId);\n        setLiveContextData(null);\n        setIsFetchingContext(true);\n\n        const result = await getRealTimeLearnContext(topic);\n        if (result) {\n            setLiveContextData({ text: result.text || '', sources: result.sources || [] });\n        } else {\n            setLiveContextData({ text: \"Could not fetch live data right now.\", sources: [] });\n        }\n        setIsFetchingContext(false);\n    };\n\n    const handleAnswer = (option: LessonOption) => processResult(option.isCorrect, option.feedback);\n    const handleScenarioAnswer = (isCorrect: boolean, feedback: string) => processResult(isCorrect, feedback);\n\n    // NEW: Binary Choice Handler\n    const handleBinaryChoice = (isCorrect: boolean, feedback: string) => {\n        if (lessonStatus !== 'idle') return;\n        processResult(isCorrect, feedback);\n    };\n\n    const processResult = (isCorrect: boolean, feedback: string) => {\n        const currentStep = activeModule?.steps[currentStepIndex];\n        const explanation = currentStep?.correctAnswerExplanation ? ` ${currentStep.correctAnswerExplanation}` : '';\n\n        if (isCorrect) {\n            setLessonFeedback({ isCorrect: true, text: feedback + explanation });\n            setCombo(prev => prev + 1);\n            setLessonStatus('correct');\n        } else {\n            const newWrong = wrongAttempts + 1;\n            setWrongAttempts(newWrong);\n            if (newWrong >= 3 && currentStep) {\n                triggerMercyRule(currentStep);\n            } else {\n                setLessonFeedback({ isCorrect: false, text: feedback });\n                setHearts(prev => prev - 1);\n                setCombo(0);\n                setLessonStatus('wrong');\n            }\n        }\n    };\n\n    const triggerMercyRule = (currentStep: LessonStep) => {\n        setLessonStatus('mercy');\n        let answerText = \"The correct answer is shown above.\";\n\n        if (currentStep.type === 'puzzle') answerText = `The word was: ${currentStep.puzzleWord}`;\n        else if (currentStep.type === 'fill-blank') answerText = `The answer is: ${currentStep.fillBlankCorrect}`;\n        else if (currentStep.type === 'sorting') answerText = `Correct order: ${currentStep.sortCorrectOrder?.join(' → ')}`;\n        else if (currentStep.type === 'question') {\n            const correctOpt = currentStep.options?.find(o => o.isCorrect);\n            answerText = `Correct answer: ${correctOpt?.text}`;\n        } else if (currentStep.type === 'scenario') {\n            const correctOpt = currentStep.scenarioOptions?.find(o => o.isCorrect);\n            answerText = `Best choice: ${correctOpt?.text}`;\n        } else if (currentStep.type === 'slider-allocator') {\n            answerText = `Target: ${currentStep.allocatorCategories?.map(c => `${c.label}: ${c.targetPercent}%`).join(', ')}`;\n            setAllocatorValues(currentStep.allocatorCategories?.map(c => ({ label: c.label, value: c.targetPercent })) || []);\n        } else if (currentStep.type === 'text-selector') {\n            answerText = \"Look for the red highlighted words.\";\n        } else if (currentStep.type === 'binary-choice') {\n            answerText = currentStep.binaryLeft?.isCorrect ? currentStep.binaryLeft.label : currentStep.binaryRight?.label || '';\n        }\n\n        const explanation = currentStep.correctAnswerExplanation ? `\\n\\n${currentStep.correctAnswerExplanation}` : '';\n        setLessonFeedback({ isCorrect: false, text: answerText + explanation });\n    };\n\n    const handlePuzzleSubmit = (e: React.FormEvent, correctWord: string) => {\n        e.preventDefault();\n        if (lessonStatus !== 'idle') return;\n        if (puzzleInput.trim().toUpperCase() === correctWord.toUpperCase()) processResult(true, \"Access Granted.\");\n        else {\n            setPuzzleShake(true);\n            setTimeout(() => setPuzzleShake(false), 500);\n            processResult(false, \"Incorrect Code.\");\n        }\n    };\n\n    const handleFillBlank = (option: string, correct: string) => {\n        if (lessonStatus !== 'idle') return;\n        if (option === correct) processResult(true, \"Perfect match.\");\n        else processResult(false, \"Incorrect term.\");\n    };\n\n    const handleSortClick = (item: string, correctOrder: string[]) => {\n        if (lessonStatus !== 'idle' || sortCurrentOrder.includes(item)) return;\n        const newOrder = [...sortCurrentOrder, item];\n        setSortCurrentOrder(newOrder);\n\n        const currentIndex = newOrder.length - 1;\n        if (newOrder[currentIndex] !== correctOrder[currentIndex]) {\n            processResult(false, \"Wrong order! Resetting.\");\n            setTimeout(() => {\n                setSortCurrentOrder([]);\n                setLessonStatus('idle');\n                setLessonFeedback(null);\n            }, 1000);\n        } else if (newOrder.length === correctOrder.length) {\n            processResult(true, \"Sequence Verified.\");\n        }\n    };\n\n    const handleConnectionClick = (item: string, pairs: { term: string, match: string }[]) => {\n        if (lessonStatus !== 'idle' || matchedConnections.includes(item)) return;\n\n        if (!selectedConnection) {\n            setSelectedConnection(item);\n        } else {\n            const isMatch = pairs.some(p =>\n                (p.term === selectedConnection && p.match === item) ||\n                (p.match === selectedConnection && p.term === item)\n            );\n\n            if (isMatch) {\n                const newMatches = [...matchedConnections, selectedConnection, item];\n                setMatchedConnections(newMatches);\n                setSelectedConnection(null);\n                if (newMatches.length === pairs.length * 2) {\n                    processResult(true, \"All Systems Connected.\");\n                }\n            } else {\n                setLessonFeedback({ isCorrect: false, text: \"Mis-match detected.\" });\n                setHearts(prev => prev - 1);\n                setSelectedConnection(null);\n                setTimeout(() => setLessonFeedback(null), 1000);\n            }\n        }\n    };\n\n    const handleAllocatorChange = (label: string, newValue: number) => {\n        if (lessonStatus !== 'idle') return;\n        setAllocatorValues(prev => prev.map(p => p.label === label ? { ...p, value: newValue } : p));\n    };\n\n    const checkAllocator = (targets: AllocatorCategory[]) => {\n        const isCorrect = targets.every(t => {\n            const current = allocatorValues.find(v => v.label === t.label);\n            return current && Math.abs(current.value - t.targetPercent) < 5; // Allow 5% margin\n        });\n\n        if (isCorrect) processResult(true, \"Perfectly Balanced.\");\n        else processResult(false, \"Ratios are off. Try again.\");\n    };\n\n    const handleSelectorClick = (word: string, targetPhrases: string[]) => {\n        if (lessonStatus !== 'idle') return;\n\n        // Clean word\n        const cleanWord = word.replace(/[^a-zA-Z0-9]/g, '');\n        if (selectedWords.includes(cleanWord)) return;\n\n        const isTarget = targetPhrases.some(phrase => phrase.toLowerCase().includes(cleanWord.toLowerCase()) || cleanWord.toLowerCase().includes(phrase.toLowerCase()));\n\n        if (isTarget) {\n            const newSelected = [...selectedWords, cleanWord];\n            setSelectedWords(newSelected);\n\n            // Check if all targets found (simplified check: assumes 1 word per target or close enough)\n            if (newSelected.length >= targetPhrases.length) {\n                processResult(true, \"Threats Identified.\");\n            }\n        } else {\n            processResult(false, \"That word is safe.\");\n        }\n    };\n\n    const handleNextInfo = () => setLessonStatus('correct');\n\n    const handleMercyNext = () => {\n        // Advance without points\n        if (activeModule && currentStepIndex < activeModule.steps.length - 1) {\n            setCurrentStepIndex(prev => prev + 1);\n            resetStepState();\n        } else {\n            finishModule();\n        }\n    }\n\n    const handleRetryStep = () => { setLessonFeedback(null); setLessonStatus('idle'); };\n\n\n\n    const closeVictory = () => { setShowVictory(false); setActiveModule(null); setLessonStatus('idle'); };\n\n    // --- RENDERERS ---\n\n    if (viewMode === 'lesson' && activeModule) {\n        const currentStep = activeModule.steps[currentStepIndex];\n        const progress = ((currentStepIndex) / activeModule.steps.length) * 100;\n\n        if (hearts <= 0) {\n            return (\n                <div className=\"min-h-[60vh] flex flex-col items-center justify-center text-center animate-fade-in\">\n                    <Mascot mood=\"shocked\" className=\"w-32 h-32 mb-6\" />\n                    <h2 className=\"text-4xl font-black uppercase font-display mb-2\">Mission Failed!</h2>\n                    <p className=\"font-bold text-gray-500 mb-8\">You ran out of hearts. Study up and try again.</p>\n                    <button onClick={() => handleStartModule(activeModule)} className=\"bg-banky-yellow border-2 border-ink px-8 py-4 font-black uppercase shadow-neo hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all\">Try Again</button>\n                    <button onClick={() => setViewMode('map')} className=\"mt-4 font-bold text-gray-400 hover:text-ink\">Quit</button>\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"max-w-2xl mx-auto pb-20 relative\">\n                <div className=\"flex items-center justify-between mb-8 sticky top-0 bg-paper z-20 py-4 border-b-2 border-transparent\">\n                    <button onClick={() => setViewMode('map')}><X className=\"w-6 h-6\" /></button>\n                    <div className=\"flex-1 mx-4\">\n                        <div className=\"h-4 bg-gray-200 rounded-full border-2 border-ink overflow-hidden\">\n                            <div className=\"h-full bg-banky-green transition-all duration-500\" style={{ width: `${progress}%` }}></div>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                        <Heart className=\"w-6 h-6 fill-red-500 text-red-500 animate-pulse\" />\n                        <span className=\"font-black text-xl\">{hearts}</span>\n                    </div>\n                </div>\n\n                {combo > 1 && (\n                    <div className=\"absolute top-16 right-0 animate-bounce-slow\">\n                        <div className=\"bg-banky-orange text-white px-3 py-1 font-black uppercase border-2 border-ink rotate-12 shadow-neo-sm\">Combo x{combo}!</div>\n                    </div>\n                )}\n\n                <div className=\"bg-white border-2 border-ink shadow-neo p-8 min-h-[400px] flex flex-col justify-center relative overflow-hidden\">\n                    <div className=\"relative z-10\">\n                        <span className={`px-2 py-1 text-xs font-black uppercase mb-4 inline-block tracking-widest bg-ink text-white`}>\n                            {currentStep.type === 'connections' ? 'Link Data' : currentStep.type === 'slider-allocator' ? 'Budget Balance' : currentStep.type === 'text-selector' ? 'Red Flag Hunter' : currentStep.type === 'binary-choice' ? 'Rapid Fire' : currentStep.type}\n                        </span>\n\n                        {currentStep.type !== 'fill-blank' && currentStep.type !== 'text-selector' && (\n                            <h2 className=\"text-2xl md:text-3xl font-black mb-8 font-display leading-tight\">{currentStep.content}</h2>\n                        )}\n\n                        {currentStep.type === 'text-selector' && (\n                            <h2 className=\"text-xl font-bold mb-4 font-display text-gray-500 uppercase\">{currentStep.content}</h2>\n                        )}\n\n                        {currentStep.type === 'info' && (\n                            <button onClick={handleNextInfo} className=\"w-full bg-banky-yellow border-2 border-ink py-4 font-black uppercase shadow-neo hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all flex items-center justify-center gap-2\">\n                                Got it <ArrowLeft className=\"w-5 h-5 rotate-180\" />\n                            </button>\n                        )}\n\n                        {currentStep.type === 'question' && (\n                            <div className=\"space-y-3\">\n                                {currentStep.options?.map((opt) => {\n                                    let stateStyles = 'bg-white hover:bg-gray-50';\n                                    if (lessonFeedback) {\n                                        if (opt.isCorrect && lessonFeedback.isCorrect) {\n                                            if (opt.text === currentStep.options?.find(o => o.isCorrect)?.text) stateStyles = 'bg-banky-green border-banky-green';\n                                        } else if (!opt.isCorrect && !lessonFeedback.isCorrect && lessonFeedback.text === opt.feedback) {\n                                            stateStyles = 'bg-red-100 border-red-500 opacity-50';\n                                        }\n                                    }\n                                    return (\n                                        <button key={opt.id} onClick={() => handleAnswer(opt)} disabled={lessonStatus !== 'idle'} className={`w-full border-2 border-ink p-4 text-left font-bold transition-all relative ${stateStyles} ${lessonStatus === 'idle' && 'hover:-translate-y-1 hover:shadow-neo-sm'}`}>\n                                            {opt.text}\n                                        </button>\n                                    );\n                                })}\n                            </div>\n                        )}\n\n                        {/* NEW: BINARY CHOICE RENDER */}\n                        {currentStep.type === 'binary-choice' && currentStep.binaryLeft && currentStep.binaryRight && (\n                            <div className=\"grid grid-cols-2 gap-4 animate-fade-in\">\n                                <button\n                                    onClick={() => handleBinaryChoice(currentStep.binaryLeft!.isCorrect, currentStep.binaryLeft!.feedback)}\n                                    disabled={lessonStatus !== 'idle'}\n                                    className=\"bg-banky-blue text-white border-4 border-ink rounded-xl p-8 flex flex-col items-center justify-center gap-4 hover:scale-105 transition-transform shadow-neo\"\n                                >\n                                    <ThumbsUp className=\"w-12 h-12\" />\n                                    <span className=\"font-black text-xl uppercase font-display\">{currentStep.binaryLeft.label}</span>\n                                </button>\n                                <button\n                                    onClick={() => handleBinaryChoice(currentStep.binaryRight!.isCorrect, currentStep.binaryRight!.feedback)}\n                                    disabled={lessonStatus !== 'idle'}\n                                    className=\"bg-banky-pink text-white border-4 border-ink rounded-xl p-8 flex flex-col items-center justify-center gap-4 hover:scale-105 transition-transform shadow-neo\"\n                                >\n                                    <ThumbsDown className=\"w-12 h-12\" />\n                                    <span className=\"font-black text-xl uppercase font-display\">{currentStep.binaryRight.label}</span>\n                                </button>\n                            </div>\n                        )}\n\n                        {/* SLIDER ALLOCATOR RENDER */}\n                        {currentStep.type === 'slider-allocator' && currentStep.allocatorCategories && (\n                            <div className=\"space-y-6 animate-fade-in\">\n                                {currentStep.allocatorCategories.map((cat, idx) => {\n                                    const currentVal = allocatorValues.find(v => v.label === cat.label)?.value || 0;\n                                    return (\n                                        <div key={idx}>\n                                            <div className=\"flex justify-between font-black uppercase text-sm mb-2\">\n                                                <span>{cat.label}</span>\n                                                <span className=\"text-banky-blue\">{currentVal}%</span>\n                                            </div>\n                                            <input\n                                                type=\"range\"\n                                                min=\"0\"\n                                                max=\"100\"\n                                                step=\"5\"\n                                                disabled={lessonStatus !== 'idle'}\n                                                value={currentVal}\n                                                onChange={(e) => handleAllocatorChange(cat.label, parseInt(e.target.value))}\n                                                className=\"w-full h-4 bg-gray-200 rounded-full appearance-none cursor-pointer accent-ink border-2 border-ink\"\n                                            />\n                                        </div>\n                                    )\n                                })}\n                                <button\n                                    onClick={() => checkAllocator(currentStep.allocatorCategories!)}\n                                    disabled={lessonStatus !== 'idle'}\n                                    className=\"w-full mt-4 bg-banky-yellow border-2 border-ink py-4 font-black uppercase shadow-neo hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all\"\n                                >\n                                    Check Balance\n                                </button>\n                            </div>\n                        )}\n\n                        {/* TEXT SELECTOR RENDER */}\n                        {currentStep.type === 'text-selector' && currentStep.content && (\n                            <div className=\"bg-gray-100 border-2 border-ink p-6 rounded-lg font-mono text-lg leading-loose animate-fade-in shadow-inner\">\n                                <div className=\"flex flex-wrap gap-2\">\n                                    {currentStep.type === 'text-selector' && (\n                                        (currentStep.id === '27-2'\n                                            ? \"URGENT : Your account is suspended . Click here to verify password .\"\n                                            : currentStep.id === '27-3'\n                                                ? \"Earn $500 daily with No Experience . We send you a check for equipment .\"\n                                                : currentStep.id === '29-2'\n                                                    ? \"Loan Agreement : 400% APR . Failure to pay results in wage garnishment and access to contacts .\"\n                                                    : currentStep.content\n                                        ).split(' ').map((word, idx) => {\n                                            const cleanWord = word.replace(/[^a-zA-Z0-9%]/g, ''); // allow % for APR\n                                            const isSelected = selectedWords.includes(cleanWord);\n                                            const isTarget = currentStep.selectorTargetPhrases?.some(p => p.toLowerCase().includes(cleanWord.toLowerCase()));\n\n                                            let style = \"bg-white border-2 border-transparent hover:border-ink cursor-pointer px-1 rounded\";\n\n                                            if (isSelected) {\n                                                style = isTarget ? \"bg-red-500 text-white border-red-700 animate-pulse\" : \"bg-gray-300 text-gray-500 line-through\";\n                                            }\n\n                                            return (\n                                                <span\n                                                    key={idx}\n                                                    onClick={() => handleSelectorClick(cleanWord, currentStep.selectorTargetPhrases || [])}\n                                                    className={style}\n                                                >\n                                                    {word}\n                                                </span>\n                                            )\n                                        })\n                                    )}\n                                </div>\n                                <div className=\"mt-4 text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2\">\n                                    <MousePointerClick className=\"w-4 h-4\" /> Tap suspicious words\n                                </div>\n                            </div>\n                        )}\n\n                        {currentStep.type === 'connections' && currentStep.connectionPairs && (\n                            <div className=\"grid grid-cols-2 gap-4 animate-fade-in\">\n                                {shuffledConnectionItems\n                                    .map((item, idx) => {\n                                        const isMatched = matchedConnections.includes(item);\n                                        const isSelected = selectedConnection === item;\n                                        return (\n                                            <button\n                                                key={idx}\n                                                onClick={() => handleConnectionClick(item, currentStep.connectionPairs!)}\n                                                disabled={isMatched || lessonStatus !== 'idle'}\n                                                className={`p-4 border-2 border-ink font-bold text-sm shadow-sm transition-all ${isMatched ? 'bg-banky-green opacity-50 scale-95' :\n                                                    isSelected ? 'bg-banky-yellow -translate-y-1 shadow-neo-sm' :\n                                                        'bg-white hover:bg-gray-50'\n                                                    }`}\n                                            >\n                                                {item}\n                                            </button>\n                                        )\n                                    })\n                                }\n                            </div>\n                        )}\n\n                        {currentStep.type === 'scenario' && (\n                            <div className=\"grid grid-cols-1 gap-4\">\n                                {currentStep.scenarioOptions?.map((opt, idx) => (\n                                    <button key={idx} onClick={() => handleScenarioAnswer(opt.isCorrect, opt.feedback)} disabled={lessonStatus !== 'idle'} className={`border-2 border-ink p-6 text-left hover:shadow-neo transition-all bg-white`}>\n                                        <p className=\"font-black text-lg mb-1 uppercase font-display\">{opt.text}</p>\n                                    </button>\n                                ))}\n                            </div>\n                        )}\n\n                        {currentStep.type === 'puzzle' && currentStep.puzzleWord && (\n                            <form onSubmit={(e) => handlePuzzleSubmit(e, currentStep.puzzleWord!)} className=\"animate-fade-in\">\n                                <div className=\"bg-ink p-6 rounded-lg mb-6 text-center relative border-4 border-gray-500\">\n                                    <p className=\"text-4xl md:text-6xl font-black text-white tracking-[0.5em] font-mono break-all\">{currentStep.scramble}</p>\n                                </div>\n                                <input autoFocus type=\"text\" value={puzzleInput} onChange={(e) => setPuzzleInput(e.target.value)} className={`w-full border-4 border-ink p-4 font-black text-xl uppercase bg-ink text-white ${puzzleShake ? 'border-red-500' : ''}`} placeholder=\"TYPE ANSWER...\" disabled={lessonStatus === 'correct' || lessonStatus === 'mercy'} />\n                                <button type=\"submit\" disabled={!puzzleInput || lessonStatus === 'mercy'} className=\"w-full bg-banky-purple text-white border-2 border-ink py-4 font-black uppercase mt-4\">Unlock</button>\n                            </form>\n                        )}\n\n                        {currentStep.type === 'fill-blank' && (\n                            <div className=\"animate-fade-in\">\n                                <div className=\"bg-gray-100 border-2 border-ink p-6 mb-6 rounded-lg text-2xl font-black leading-relaxed font-display\">\n                                    {currentStep.content.split('[BLANK]').map((part, i) => (\n                                        <React.Fragment key={i}>{part}{i < currentStep.content.split('[BLANK]').length - 1 && (<span className=\"inline-block border-b-4 border-banky-blue min-w-[100px] text-center text-banky-blue mx-2\">{lessonStatus === 'correct' || lessonStatus === 'mercy' ? currentStep.fillBlankCorrect : '_____'}</span>)}</React.Fragment>\n                                    ))}\n                                </div>\n                                <div className=\"grid grid-cols-2 gap-3\">\n                                    {currentStep.fillBlankOptions?.map((opt) => (\n                                        <button key={opt} onClick={() => handleFillBlank(opt, currentStep.fillBlankCorrect || '')} disabled={lessonStatus !== 'idle'} className=\"py-4 border-2 border-ink font-bold uppercase bg-white hover:shadow-neo-sm transition-all\">{opt}</button>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n\n                        {currentStep.type === 'sorting' && (\n                            <div className=\"animate-fade-in\">\n                                <div className=\"space-y-2 mb-6 min-h-[150px]\">\n                                    {sortCurrentOrder.map((item, idx) => (\n                                        <div key={item} className=\"bg-banky-blue text-white border-2 border-ink p-3 font-bold flex items-center gap-3 shadow-neo-sm\"><span className=\"w-6 h-6 bg-white text-ink rounded-full flex items-center justify-center text-xs font-black\">{idx + 1}</span>{item}</div>\n                                    ))}\n                                </div>\n                                <div className=\"grid grid-cols-1 gap-2\">\n                                    {currentStep.sortCorrectOrder?.filter(i => !sortCurrentOrder.includes(i)).sort().map((item) => (\n                                        <button key={item} onClick={() => handleSortClick(item, currentStep.sortCorrectOrder || [])} disabled={lessonStatus === 'correct' || lessonStatus === 'mercy'} className=\"p-3 bg-white border-2 border-ink font-bold text-left hover:bg-gray-50 transition-all\">{item}</button>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {lessonFeedback && (\n                        <div className={`mt-6 p-4 border-2 border-ink font-bold animate-fade-in-up ${lessonStatus === 'mercy' ? 'bg-blue-100 text-blue-900' : lessonFeedback.isCorrect ? 'bg-banky-green text-ink' : 'bg-red-100 text-red-800'}`}>\n                            {lessonStatus === 'mercy' && <p className=\"font-black uppercase text-xs mb-2 flex items-center gap-1\"><AlertTriangle className=\"w-4 h-4\" /> Too Many Attempts</p>}\n                            <p className=\"whitespace-pre-wrap\">{lessonFeedback.text}</p>\n                            {!lessonFeedback.isCorrect && lessonStatus !== 'mercy' && <button onClick={handleRetryStep} className=\"mt-2 text-xs uppercase underline font-black hover:text-red-950 flex items-center gap-1\"><RotateCcw className=\"w-3 h-3\" /> Try Again</button>}\n                            {lessonStatus === 'mercy' && (\n                                <button\n                                    onClick={handleMercyNext}\n                                    className=\"mt-4 w-full bg-blue-600 text-white border-2 border-blue-800 py-2 font-black uppercase hover:bg-blue-700 flex items-center justify-center gap-2\"\n                                >\n                                    Move On <ArrowRight className=\"w-4 h-4\" />\n                                </button>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </div>\n        );\n    }\n\n    // Calculate Map Height based on modules for Responsive SVG\n    const mapHeight = modules.length * 160 + 200;\n\n    return (\n        <div className=\"max-w-5xl mx-auto min-h-screen font-sans\">\n\n            {/* REGION SWITCH WARNING MODAL */}\n            {pendingRegion && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-ink/80 backdrop-blur-sm animate-fade-in\">\n                    <div className=\"bg-white border-4 border-ink shadow-neo-xl max-w-sm w-full p-6 text-center\">\n                        <AlertTriangle className=\"w-12 h-12 text-banky-yellow mx-auto mb-4\" />\n                        <h3 className=\"text-2xl font-black uppercase font-display mb-2\">Switch Region?</h3>\n                        <p className=\"font-bold text-gray-500 mb-6\">\n                            You are switching from <span className=\"text-ink\">{region}</span> to <span className=\"text-ink\">{pendingRegion}</span>.\n                            Your progress in {region} will be saved, but you will start fresh on the {pendingRegion} map.\n                        </p>\n                        <div className=\"flex gap-2\">\n                            <button onClick={() => setPendingRegion(null)} className=\"flex-1 border-2 border-ink py-3 font-black uppercase hover:bg-gray-100\">Cancel</button>\n                            <button onClick={confirmRegionChange} className=\"flex-1 bg-banky-yellow border-2 border-ink py-3 font-black uppercase shadow-neo hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all\">Confirm</button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* LIVE CONTEXT MODAL */}\n            {showLiveContext && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-ink/90 backdrop-blur-sm animate-fade-in\">\n                    <div className=\"bg-white border-4 border-ink shadow-neo-xl w-full max-w-md p-6 relative\">\n                        <button onClick={() => setShowLiveContext(null)} className=\"absolute top-2 right-2 p-2 hover:bg-gray-100\"><X className=\"w-5 h-5\" /></button>\n\n                        <div className=\"flex items-center gap-2 mb-4 text-banky-blue\">\n                            <Globe className=\"w-6 h-6 animate-pulse\" />\n                            <h3 className=\"text-xl font-black uppercase font-display\">Live Intel</h3>\n                        </div>\n\n                        {isFetchingContext ? (\n                            <div className=\"flex flex-col items-center justify-center py-12\">\n                                <Loader2 className=\"w-8 h-8 animate-spin text-ink mb-2\" />\n                                <p className=\"font-bold text-gray-400 uppercase text-xs tracking-widest\">Scanning Real World...</p>\n                            </div>\n                        ) : (\n                            <div>\n                                <p className=\"font-medium text-lg leading-relaxed mb-6\">{liveContextData?.text}</p>\n\n                                {liveContextData?.sources && liveContextData.sources.length > 0 && (\n                                    <div className=\"border-t-2 border-gray-100 pt-4\">\n                                        <p className=\"text-[10px] font-black uppercase text-gray-400 mb-2\">Sources</p>\n                                        <div className=\"flex flex-wrap gap-2\">\n                                            {liveContextData.sources.map((src, i) => (\n                                                <a\n                                                    key={i}\n                                                    href={src.uri}\n                                                    target=\"_blank\"\n                                                    rel=\"noreferrer\"\n                                                    className=\"text-xs bg-gray-100 hover:bg-banky-blue hover:text-white text-ink px-2 py-1 rounded border border-gray-300 hover:border-ink transition-colors flex items-center gap-1 font-bold\"\n                                                >\n                                                    {src.title} <ExternalLink className=\"w-3 h-3\" />\n                                                </a>\n                                            ))}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n            <div className=\"flex flex-col md:flex-row justify-between items-center bg-white border-2 border-ink p-4 shadow-neo sticky top-0 z-40 gap-4\">\n                <div className=\"flex items-center gap-2 w-full md:w-auto\">\n                    <div className=\"bg-banky-yellow p-2 border-2 border-ink\"><MapIcon className=\"w-5 h-5\" /></div>\n                    <div><h1 className=\"font-black uppercase font-display leading-none\">Campaign</h1><p className=\"text-xs font-bold text-gray-500\">Level {userState.level}</p></div>\n                </div>\n\n                {/* Right Side: Unified Actions */}\n                <div className=\"flex items-center gap-3 w-full md:w-auto justify-end bg-white\">\n                    <div className=\"relative h-full\">\n                        <button onClick={() => setShowRegionMenu(!showRegionMenu)} className=\"flex items-center gap-2 bg-ink text-white px-4 py-2 border-2 border-ink font-black uppercase text-xs tracking-wider hover:bg-gray-800 h-full shadow-sm\">\n                            <Globe className=\"w-4 h-4\" /> {region === 'IN' ? 'India' : region === 'US' ? 'USA' : 'Global'}\n                        </button>\n                        {showRegionMenu && (\n                            <div className=\"absolute top-full right-0 mt-2 bg-white border-2 border-ink shadow-neo w-40 z-50 flex flex-col\">\n                                {['US', 'IN', 'Global'].map((r) => (\n                                    <button\n                                        key={r}\n                                        onClick={() => handleRegionChange(r as RegionCode)}\n                                        className=\"p-3 text-left font-bold hover:bg-banky-yellow border-b-2 border-ink last:border-0\"\n                                    >\n                                        {r === 'IN' ? '🇮🇳 India' : r === 'US' ? '🇺🇸 USA' : '🌍 Global'}\n                                    </button>\n                                ))}\n                            </div>\n                        )}\n                    </div>\n\n                    <button onClick={() => setShowPlaybook(true)} className=\"flex items-center gap-2 px-4 py-2 bg-banky-blue text-white border-2 border-ink font-black uppercase shadow-sm hover:shadow-neo-sm transition-all text-xs md:text-sm\"><Book className=\"w-4 h-4\" /> Playbook</button>\n                    <button onClick={() => setShowInventory(true)} className=\"flex items-center gap-2 px-4 py-2 bg-banky-pink border-2 border-ink font-black uppercase shadow-sm hover:shadow-neo-sm transition-all text-xs md:text-sm\"><Package className=\"w-4 h-4\" /> Loot</button>\n                </div>\n            </div>\n\n            {/* RESPONSIVE MAP CONTAINER */}\n            <div className=\"relative w-full max-w-md mx-auto mt-20 md:mt-40 pb-32 animate-fade-in select-none\">\n                {/* SVG Path with responsive scaling */}\n                <div className=\"w-full h-full relative\" style={{ height: `${mapHeight}px` }}>\n                    <svg\n                        viewBox={`0 0 380 ${mapHeight}`}\n                        className=\"absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible\"\n                        preserveAspectRatio=\"xMidYMin meet\"\n                    >\n                        <path d={`M 190,0 ${modules.map((_, i) => { const y = i * 160 + 80; const x = i % 2 === 0 ? 80 : 300; return `Q 190,${y - 80} ${x},${y}`; }).join(\" \")} L 190,${modules.length * 160 + 100}`} fill=\"none\" stroke=\"#1A1A1A\" strokeWidth=\"12\" strokeLinecap=\"round\" strokeDasharray=\"20 20\" className=\"opacity-20\" />\n                    </svg>\n\n                    {/* Module Nodes - Absolutely Positioned based on SVG Logic */}\n                    {modules.map((unit, index) => {\n                        const isPreviousCompleted = index === 0 || userState.completedUnitIds.includes(modules[index - 1].id);\n                        const isLocked = !isPreviousCompleted;\n                        const isCompleted = userState.completedUnitIds.includes(unit.id);\n                        const isActive = !isLocked && !isCompleted;\n\n                        const topPos = index * 160 + 80;\n                        const leftPos = index % 2 === 0 ? '21%' : '79%';\n\n                        return (\n                            <div\n                                key={unit.id}\n                                className=\"absolute flex flex-col items-center group\"\n                                style={{\n                                    top: `${topPos}px`,\n                                    left: leftPos,\n                                    transform: 'translate(-50%, -50%)',\n                                    width: 'max-content'\n                                }}\n                            >\n                                <button onClick={() => !isLocked && handleStartModule(unit)} disabled={isLocked} className={`w-24 h-24 rounded-full border-4 border-ink flex items-center justify-center relative transition-all duration-300 z-10 ${isCompleted ? 'bg-banky-green shadow-none scale-95 opacity-80' : isLocked ? 'bg-gray-200 cursor-not-allowed' : 'bg-banky-yellow hover:scale-110 shadow-neo hover:shadow-neo-sm'}`}>\n                                    {isCompleted ? (\n                                        <div className=\"relative\"><Check className=\"w-10 h-10 text-ink\" strokeWidth={4} /><div className=\"absolute -bottom-10 left-1/2 -translate-x-1/2 flex gap-0.5\">{[1, 2, 3].map(s => <Star key={s} className=\"w-3 h-3 fill-banky-yellow text-ink\" />)}</div></div>\n                                    ) : isLocked ? <Lock className=\"w-8 h-8 text-gray-400\" /> : (\n                                        <div className=\"relative\"><span className=\"font-black text-3xl font-display\">{index + 1}</span><div className=\"absolute inset-0 rounded-full border-2 border-white animate-ping opacity-50\"></div></div>\n                                    )}\n                                    {isActive && <div className=\"absolute -top-16 left-1/2 -translate-x-1/2 pointer-events-none z-20 animate-bounce\"><Mascot className=\"w-20 h-20\" mood=\"happy\" /></div>}\n                                </button>\n                                <div className={`absolute top-24 mt-4 bg-white border-2 border-ink px-4 py-2 shadow-neo-sm text-center min-w-[160px] transition-all z-20 ${isActive ? 'scale-105 rotate-1 bg-white' : isLocked ? 'opacity-50 grayscale' : 'bg-gray-50'}`}>\n                                    <div className=\"flex flex-col sm:flex-row items-center justify-center gap-2\">\n                                        <h3 className=\"font-black uppercase font-display leading-none text-sm\">{unit.title}</h3>\n                                        {/* New: Live Context Button */}\n                                        {!isLocked && (\n                                            <button\n                                                onClick={(e) => { e.stopPropagation(); handleLiveContext(unit.id, unit.title); }}\n                                                className=\"ml-1 p-1 bg-banky-blue text-white rounded hover:bg-banky-purple transition-colors\"\n                                                title=\"Get Live Intel\"\n                                            >\n                                                <Globe className=\"w-3 h-3\" />\n                                            </button>\n                                        )}\n                                    </div>\n                                    <p className=\"text-[10px] font-bold text-gray-500 mt-1 uppercase tracking-wider\">{unit.category}</p>\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n                {modules.length === 0 && (\n                    <div className=\"text-center p-8 bg-white border-2 border-ink shadow-neo\">\n                        <p className=\"font-bold\">No modules available for {region} yet.</p>\n                        <p className=\"text-sm text-gray-500\">Switch region or check back later!</p>\n                    </div>\n                )}\n            </div>\n\n            {/* --- PLAYBOOK MODAL --- (Existing Playbook code remains...) */}\n            {showPlaybook && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-ink/80 backdrop-blur-sm animate-fade-in\">\n                    <div className=\"bg-white border-4 border-ink shadow-neo-xl w-full max-w-5xl h-[85vh] overflow-hidden flex relative\">\n                        <button onClick={() => setShowPlaybook(false)} className=\"absolute top-4 right-4 bg-gray-100 border-2 border-ink p-2 hover:bg-red-500 hover:text-white z-30\"><X className=\"w-6 h-6\" /></button>\n\n                        {/* Sidebar */}\n                        <div className=\"w-1/3 border-r-4 border-ink bg-gray-50 flex flex-col\">\n                            <div className=\"p-6 border-b-4 border-ink bg-banky-blue text-white\">\n                                <h2 className=\"text-2xl font-black uppercase font-display flex items-center gap-2\"><Book className=\"w-6 h-6\" /> Playbook</h2>\n                                <div className=\"flex items-center gap-2 mt-1 opacity-80 text-xs font-bold uppercase tracking-widest\"><Globe className=\"w-3 h-3\" /> {region} Edition</div>\n                            </div>\n                            <div className=\"overflow-y-auto flex-1 p-2 space-y-2\">\n                                {modules.map((mod, idx) => {\n                                    const isUnlocked = userState.completedUnitIds.includes(mod.id);\n                                    const isActive = playbookModuleId === mod.id;\n                                    return (\n                                        <button\n                                            key={mod.id}\n                                            onClick={() => isUnlocked && setPlaybookModuleId(mod.id)}\n                                            disabled={!isUnlocked}\n                                            className={`w-full text-left p-4 border-2 transition-all flex items-center justify-between ${isActive ? 'bg-banky-yellow border-ink shadow-neo-sm translate-x-1' :\n                                                isUnlocked ? 'bg-white border-gray-200 hover:border-ink hover:bg-white' :\n                                                    'bg-gray-100 border-transparent opacity-50 cursor-not-allowed'\n                                                }`}\n                                        >\n                                            <div>\n                                                <span className=\"text-[10px] font-black uppercase tracking-widest opacity-60\">Unit {idx + 1}</span>\n                                                <p className=\"font-black font-display text-sm uppercase\">{mod.title}</p>\n                                            </div>\n                                            {!isUnlocked && <Lock className=\"w-4 h-4\" />}\n                                        </button>\n                                    )\n                                })}\n                            </div>\n                        </div>\n\n                        {/* Main Content (Fixed Fonts) */}\n                        <div className=\"w-2/3 bg-[#fffef0] flex flex-col relative\">\n                            {playbookModuleId ? (\n                                <>\n                                    {(() => {\n                                        const module = modules.find(m => m.id === playbookModuleId);\n                                        if (!module || !module.playbook) return null;\n                                        return (\n                                            <div className=\"flex-1 flex flex-col relative z-10\">\n                                                <div className=\"p-8 pb-4\">\n                                                    <h2 className=\"text-4xl font-black uppercase font-display mb-2 bg-white inline-block px-2 border-2 border-transparent\">{module.title}</h2>\n                                                    <div className=\"flex gap-2 border-b-4 border-ink bg-white/50 backdrop-blur-sm\">\n                                                        {[{ id: 'summary', label: 'Breakdown', icon: Split }, { id: 'real-life', label: 'Real Life', icon: Briefcase }, { id: 'dictionary', label: 'Dictionary', icon: BookOpen }, { id: 'actions', label: 'Actions', icon: Check }].map(tab => (\n                                                            <button key={tab.id} onClick={() => setPlaybookTab(tab.id as 'summary' | 'real-life' | 'dictionary' | 'actions')} className={`flex items-center gap-2 px-4 py-3 font-black uppercase text-sm border-t-2 border-x-2 border-ink -mb-[4px] relative z-10 transition-all ${playbookTab === tab.id ? 'bg-banky-pink text-ink shadow-[0_-2px_0_0_#1A1A1A]' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}`}><tab.icon className=\"w-4 h-4\" /> {tab.label}</button>\n                                                        ))}\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"flex-1 overflow-y-auto p-8 pt-4\">\n                                                    <div className=\"bg-white border-2 border-ink p-8 shadow-sm min-h-full animate-fade-in\">\n                                                        {playbookTab === 'summary' && (\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black uppercase mb-4 font-display flex items-center gap-2\"><Split className=\"w-5 h-5 text-banky-blue\" /> The Breakdown</h3>\n                                                                <p className=\"text-lg font-medium leading-relaxed font-sans text-gray-800\">{module.playbook.summary}</p>\n                                                            </div>\n                                                        )}\n                                                        {playbookTab === 'real-life' && (\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black uppercase mb-4 font-display flex items-center gap-2\"><Briefcase className=\"w-5 h-5 text-banky-green\" /> In The Wild</h3>\n                                                                <div className=\"bg-gray-50 border-l-4 border-banky-green p-6 text-lg font-medium font-sans text-gray-700 italic\">\n                                                                    \"{module.playbook.realLifeExample}\"\n                                                                </div>\n                                                            </div>\n                                                        )}\n                                                        {playbookTab === 'dictionary' && (\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black uppercase mb-4 font-display flex items-center gap-2\"><BookOpen className=\"w-5 h-5 text-banky-pink\" /> Jargon Buster</h3>\n                                                                <div className=\"space-y-4\">\n                                                                    {module.playbook.definitions.map((def, i) => (\n                                                                        <div key={i} className=\"border-b-2 border-gray-100 pb-4 last:border-0\">\n                                                                            <p className=\"font-black font-display text-lg bg-banky-yellow inline-block px-1 mb-1\">{def.term}</p>\n                                                                            <p className=\"font-medium font-sans text-gray-700\">{def.definition}</p>\n                                                                        </div>\n                                                                    ))}\n                                                                </div>\n                                                            </div>\n                                                        )}\n                                                        {playbookTab === 'actions' && (\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black uppercase mb-4 font-display flex items-center gap-2\"><Check className=\"w-5 h-5 text-ink\" /> Your Move</h3>\n                                                                <ul className=\"space-y-4\">\n                                                                    {module.playbook.actionableSteps.map((step, i) => (\n                                                                        <li key={i} className=\"flex items-start gap-3\">\n                                                                            <div className=\"w-6 h-6 border-2 border-ink rounded flex items-center justify-center flex-shrink-0 mt-0.5 bg-white\"></div>\n                                                                            <span className=\"font-bold text-lg font-sans\">{step}</span>\n                                                                        </li>\n                                                                    ))}\n                                                                </ul>\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        )\n                                    })()}\n                                </>\n                            ) : (\n                                <div className=\"flex-1 flex flex-col items-center justify-center text-gray-400 p-12 text-center\">\n                                    <Book className=\"w-16 h-16 mb-4 opacity-20\" />\n                                    <p className=\"font-bold font-display text-xl\">Select a Unit</p>\n                                    <p>Choose an unlocked module from the left.</p>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {showInventory && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-ink/80 backdrop-blur-sm animate-fade-in\">\n                    <div className=\"bg-paper border-4 border-ink shadow-neo-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col relative\">\n                        <button onClick={() => setShowInventory(false)} className=\"absolute top-4 right-4 bg-white border-2 border-ink p-2 hover:bg-gray-100 z-10\"><X className=\"w-6 h-6\" /></button>\n                        <div className=\"p-6 border-b-4 border-ink bg-banky-pink\"><h2 className=\"text-3xl font-black uppercase font-display flex items-center gap-3\"><Package className=\"w-8 h-8\" /> My Stash</h2></div>\n                        <div className=\"p-8 overflow-y-auto grid grid-cols-2 sm:grid-cols-4 gap-4\">\n                            {userState.inventory.length === 0 ? (\n                                <div className=\"col-span-full text-center py-12 text-gray-400\"><Package className=\"w-16 h-16 mx-auto mb-4 opacity-20\" /><p className=\"font-bold\">Your bag is empty.</p><p className=\"text-sm\">Complete lessons to earn loot.</p></div>\n                            ) : (\n                                userState.inventory.map((itemId, idx) => {\n                                    const item = LOOT_TABLE.find(l => l.id === itemId);\n                                    if (!item) return null;\n                                    return (\n                                        <div key={`${itemId}-${idx}`} className=\"bg-white border-2 border-ink p-4 flex flex-col items-center text-center shadow-sm hover:scale-105 transition-transform\"><div className=\"text-4xl mb-2 animate-bounce-slow\">{item.emoji}</div><p className=\"font-black text-xs uppercase leading-tight\">{item.name}</p><span className={`text-[10px] font-bold px-1.5 py-0.5 mt-2 border border-ink rounded ${item.rarity === 'Legendary' ? 'bg-banky-yellow' : item.rarity === 'Rare' ? 'bg-banky-blue text-white' : 'bg-gray-100 text-gray-500'}`}>{item.rarity}</span></div>\n                                    )\n                                })\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {showVictory && earnedLoot && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-ink/90 backdrop-blur-md animate-fade-in\">\n                    <div className=\"bg-white border-4 border-ink shadow-neo-xl max-w-sm w-full p-8 text-center relative overflow-hidden\">\n                        <div className=\"absolute inset-0 bg-[conic-gradient(from_0deg_at_50%_50%,#D4FF00_0deg,#fff_60deg,#D4FF00_120deg,#fff_180deg,#D4FF00_240deg,#fff_300deg,#D4FF00_360deg)] opacity-20 animate-spin-slow\"></div>\n                        <div className=\"relative z-10\"><div className=\"inline-block bg-banky-green text-ink border-2 border-ink px-3 py-1 font-black uppercase rotate-[-2deg] mb-6 shadow-sm\">Module Complete!</div><div className=\"w-32 h-32 mx-auto bg-white border-4 border-ink rounded-full flex items-center justify-center text-6xl shadow-neo mb-6 animate-bounce\">{earnedLoot.emoji}</div><h2 className=\"text-2xl font-black uppercase font-display mb-1\">{earnedLoot.name}</h2><p className=\"font-bold text-gray-500 uppercase text-xs tracking-widest mb-6\">{earnedLoot.rarity} Item Found</p><div className=\"flex gap-4 justify-center font-bold font-mono text-sm mb-8\"><div className=\"flex items-center gap-1 bg-gray-100 px-2 py-1 border border-gray-300\"><Star className=\"w-4 h-4 text-banky-yellow fill-current\" />+{activeModule?.xpReward} XP</div></div><button onClick={closeVictory} className=\"w-full bg-ink text-white py-4 font-black uppercase tracking-widest border-2 border-transparent hover:bg-banky-pink hover:text-ink hover:border-ink hover:shadow-neo transition-all\">Claim Reward</button></div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default Education;\n","usedDeprecatedRules":[]}]
